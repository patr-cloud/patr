{
  "db_name": "PostgreSQL",
  "query": "ALTER TABLE deployment ADD CONSTRAINT deployment_chk_name_is_trimmed CHECK(name = TRIM(name)), ADD CONSTRAINT deployment_chk_image_name_is_valid CHECK(image_name ~ '^[a-zA-Z0-9\\-_ \\./]{4,255}$'), ADD CONSTRAINT deployment_fk_runner FOREIGN KEY(runner) REFERENCES runner(id), ADD CONSTRAINT deployment_chk_min_horizontal_scale_u8 CHECK(min_horizontal_scale >= 0 AND min_horizontal_scale <= 256 AND min_horizontal_scale <= max_horizontal_scale), ADD CONSTRAINT deployment_chk_max_horizontal_scale_u8 CHECK(max_horizontal_scale >= 0 AND max_horizontal_scale <= 256 AND max_horizontal_scale >= min_horizontal_scale), ADD CONSTRAINT deployment_fk_machine_type FOREIGN KEY(machine_type) REFERENCES deployment_machine_type(id), ADD CONSTRAINT deployment_fk_repository_id_workspace_id FOREIGN KEY(repository_id, workspace_id) REFERENCES container_registry_repository(id, workspace_id), ADD CONSTRAINT deployment_chk_repository_id_is_valid CHECK((registry = 'registry.patr.cloud' AND image_name IS NULL AND repository_id IS NOT NULL) OR (registry != 'registry.patr.cloud' AND image_name IS NOT NULL AND repository_id IS NULL)), ADD CONSTRAINT deployment_chk_image_tag_is_valid CHECK(image_tag != ''), ADD CONSTRAINT deployment_chk_startup_probe_is_valid CHECK((startup_probe_port IS NULL AND startup_probe_path IS NULL AND startup_probe_port_type IS NULL) OR (startup_probe_port IS NOT NULL AND startup_probe_path IS NOT NULL AND startup_probe_port_type IS NOT NULL)), ADD CONSTRAINT deployment_chk_liveness_probe_is_valid CHECK((liveness_probe_port IS NULL AND liveness_probe_path IS NULL AND liveness_probe_port_type IS NULL) OR (liveness_probe_port IS NOT NULL AND liveness_probe_path IS NOT NULL AND liveness_probe_port_type IS NOT NULL)), ADD CONSTRAINT deployment_chk_startup_probe_port_type_is_http CHECK(startup_probe_port_type = 'http'), ADD CONSTRAINT deployment_chk_liveness_probe_port_type_is_http CHECK(liveness_probe_port_type = 'http'), ADD CONSTRAINT deployment_fk_deployment_id_startup_port_startup_port_type FOREIGN KEY(id, startup_probe_port, startup_probe_port_type) REFERENCES deployment_exposed_port(deployment_id, port, port_type) DEFERRABLE INITIALLY IMMEDIATE, ADD CONSTRAINT deployment_fk_deployment_id_liveness_port_liveness_port_type FOREIGN KEY(id, liveness_probe_port, liveness_probe_port_type) REFERENCES deployment_exposed_port(deployment_id, port, port_type) DEFERRABLE INITIALLY IMMEDIATE, ADD CONSTRAINT deployment_fk_id_workspace_id_deleted FOREIGN KEY(id, workspace_id, deleted) REFERENCES resource(id, owner_id, deleted) DEFERRABLE INITIALLY IMMEDIATE, ADD CONSTRAINT deployment_fk_current_live_digest FOREIGN KEY(id, current_live_digest) REFERENCES deployment_deploy_history(deployment_id, image_digest);",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": []
    },
    "nullable": []
  },
  "hash": "cd9fdb6e728d50ac891b1126f6f715082c4b1e47d228f5b228490f0dfc10cee2"
}
